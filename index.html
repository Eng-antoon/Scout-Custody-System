<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام عهدة الكشافة</title>
    
    <!-- Bootstrap CSS 4.5.2 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Mobile Navigation Header -->
    <nav class="mobile-nav d-lg-none">
        <div class="mobile-nav-content">
            <div class="mobile-nav-brand">
                <i class="fas fa-scout text-primary"></i>
                <span>نظام عهدة الكشافة</span>
            </div>
            <div class="mobile-nav-actions" id="mobile-nav-actions">
                <!-- Dynamic content based on user role -->
            </div>
        </div>
    </nav>

    <div class="container-fluid px-2 px-lg-3">
        <!-- Main Heading -->
        <div class="row">
            <div class="col-12 text-center">
                <div class="main-header">
                    <div class="header-icon">
                            <img src="static/images/FB_IMG_1749907369634.jpg" alt="logo" style="width: 100px; height: 100px;">
                    </div>
                    <h1 class="main-title">نظام عهدة كشافة</h1>
                    <p class="main-subtitle">إدارة وحجز المعدات الكشفية</p>
                </div>
            </div>
        </div>

        <!-- Authentication Section -->
        <div id="auth-section" class="hidden">
            <div class="row justify-content-center">
                <div class="col-12 col-md-8 col-lg-6 col-xl-4">
                    <div class="auth-card">
                        <div class="auth-card-header">
                            <div class="auth-icon">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <h3>تسجيل الدخول</h3>
                            <p>أدخل بياناتك للوصول إلى النظام</p>
                        </div>
                        <div class="auth-card-body">
                            <form id="login-form">
                                <div class="form-group">
                                    <label for="login-email">
                                        <i class="fas fa-envelope"></i>
                                        البريد الالكتروني
                                    </label>
                                    <input type="email" class="form-control" id="login-email" required>
                                </div>
                                <div class="form-group">
                                    <label for="login-password">
                                        <i class="fas fa-lock"></i>
                                        كلمة السر
                                    </label>
                                    <input type="password" class="form-control" id="login-password" required>
                                </div>
                                <button type="submit" class="btn btn-primary btn-block btn-lg">
                                    <i class="fas fa-sign-in-alt"></i>
                                    تسجيل دخول
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Section -->
        <div id="admin-section" class="hidden">
            <!-- Desktop Navigation -->
            <div class="admin-header d-none d-lg-block">
                <div class="row align-items-center">
                    <div class="col-lg-6">
                        <div class="page-title">
                            <i class="fas fa-cogs text-primary"></i>
                            <h2>وحدة التحكم</h2>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="admin-nav-actions">
                            <button id="view-profile-btn" class="btn btn-outline-info">
                                <i class="fas fa-user"></i>
                                <span class="d-none d-xl-inline">ملفي الشخصي</span>
                            </button>
                            <button id="logout-admin" class="btn btn-outline-danger">
                                <i class="fas fa-sign-out-alt"></i>
                                <span class="d-none d-xl-inline">تسجيل خروج</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Admin Management Cards -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="management-card">
                        <div class="management-card-header">
                            <i class="fas fa-tools"></i>
                            <h4>إدارة النظام</h4>
                        </div>
                        <div class="management-card-body">
                            <div class="management-actions">
                                <button id="create-user-btn" class="management-btn btn-success">
                                    <i class="fas fa-user-plus"></i>
                                    <span>اضافة مستخدم</span>
                                </button>
                                <button id="manage-users-btn" class="management-btn btn-info">
                                    <i class="fas fa-users-cog"></i>
                                    <span>إدارة المستخدمين</span>
                                </button>
                                <button id="go-to-dashboard-btn" class="management-btn btn-warning">
                                    <i class="fas fa-chart-bar"></i>
                                    <span>لوحة البيانات</span>
                                </button>
                                <button id="switch-user-mode-btn" class="management-btn btn-secondary">
                                    <i class="fas fa-exchange-alt"></i>
                                    <span>نظام الطلبات</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Add Product Section -->
            <div class="enhanced-card mb-4">
                <div class="enhanced-card-header">
                    <i class="fas fa-plus-circle text-success"></i>
                    <h3>اضافة منتج جديد</h3>
                </div>
                <div class="enhanced-card-body">
                    <form id="product-form">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="product-name-en">
                                        <i class="fas fa-tag"></i>
                                        الاسم بالانجليزي
                                    </label>
                                    <input type="text" class="form-control" id="product-name-en" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="product-name-ar">
                                        <i class="fas fa-tag"></i>
                                        الاسم بالعربي
                                    </label>
                                    <input type="text" class="form-control" id="product-name-ar" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="product-counter">
                                        <i class="fas fa-sort-numeric-up"></i>
                                        العدد بالعهدة
                                    </label>
                                    <input type="number" class="form-control" id="product-counter" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="product-image">
                                        <i class="fas fa-image"></i>
                                        صورة العهدة
                                    </label>
                                    <input type="file" class="form-control-file" id="product-image" accept="image/*">
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="fas fa-plus"></i>
                            اضافة العهدة
                        </button>
                    </form>
                </div>
            </div>

            <!-- Products Table Section -->
            <div class="enhanced-card mb-4">
                <div class="enhanced-card-header">
                    <i class="fas fa-boxes text-primary"></i>
                    <h3>المنتجات المتاحة</h3>
                </div>
                <div class="enhanced-card-body">
                    <div class="table-responsive">
                        <table id="products-table" class="table table-hover enhanced-table">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-image"></i> الصورة</th>
                                    <th><i class="fas fa-globe"></i> الاسم بالانجليزي</th>
                                    <th><i class="fas fa-font"></i> الاسم بالعربي</th>
                                    <th><i class="fas fa-sort-numeric-up"></i> العدد</th>
                                    <th><i class="fas fa-cogs"></i> الاختيارات</th>
                                </tr>
                            </thead>
                            <tbody id="products-table-body">
                                <!-- Dynamic content will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Reservations Approval Section -->
            <div class="enhanced-card">
                <div class="enhanced-card-header">
                    <i class="fas fa-clipboard-check text-warning"></i>
                    <h3>قبول و رفض الطلبات</h3>
                </div>
                <div class="enhanced-card-body">
                    <div class="table-responsive">
                        <table id="reservations-approval-table" class="table table-hover enhanced-table">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-user"></i> المستخدم</th>
                                    <th><i class="fas fa-boxes"></i> المنتجات</th>
                                    <th><i class="fas fa-sort-numeric-up"></i> الكمية</th>
                                    <th><i class="fas fa-calendar-alt"></i> بداية الحجز</th>
                                    <th><i class="fas fa-calendar-alt"></i> نهاية الحجز</th>
                                    <th><i class="fas fa-info-circle"></i> الحالة</th>
                                    <th><i class="fas fa-cogs"></i> الاختيارات</th>
                                </tr>
                            </thead>
                            <tbody id="reservations-approval-table-body">
                                <!-- Dynamic content will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Product Modal -->
        <div id="edit-product-modal" class="modal hidden">
            <div class="enhanced-modal-content">
                <div class="enhanced-modal-header">
                    <h3><i class="fas fa-edit text-primary"></i> تعديل منتج</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="enhanced-modal-body">
                    <form id="edit-product-form">
                        <div class="form-group">
                            <label for="edit-product-name-en">
                                <i class="fas fa-tag"></i>
                                الاسم بالانجليزي
                            </label>
                            <input type="text" class="form-control" id="edit-product-name-en" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-product-name-ar">
                                <i class="fas fa-tag"></i>
                                الاسم بالعربي
                            </label>
                            <input type="text" class="form-control" id="edit-product-name-ar" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-product-counter">
                                <i class="fas fa-sort-numeric-up"></i>
                                العدد بالعهدة
                            </label>
                            <input type="number" class="form-control" id="edit-product-counter" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-product-image">
                                <i class="fas fa-image"></i>
                                صورة العهدة (اختياري)
                            </label>
                            <input type="file" class="form-control-file" id="edit-product-image" accept="image/*">
                            <small class="form-text text-muted">
                                <i class="fas fa-info-circle"></i>
                                اتركه فارغاً للاحتفاظ بالصورة الحالية
                            </small>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                تحديث
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Create User Modal -->
        <div id="create-user-modal" class="modal hidden">
            <div class="enhanced-modal-content">
                <div class="enhanced-modal-header">
                    <h3><i class="fas fa-user-plus text-success"></i> إضافة مستخدم جديد</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="enhanced-modal-body">
                    <form id="create-user-form">
                        <div class="form-group">
                            <label for="new-user-email">
                                <i class="fas fa-envelope"></i>
                                البريد الالكتروني
                            </label>
                            <input type="email" class="form-control" id="new-user-email" required>
                        </div>
                        <div class="form-group">
                            <label for="new-user-password">
                                <i class="fas fa-lock"></i>
                                كلمة السر
                            </label>
                            <input type="password" class="form-control" id="new-user-password" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label for="new-user-role">
                                <i class="fas fa-user-tag"></i>
                                الدور
                            </label>
                            <select class="form-control" id="new-user-role" required>
                                <option value="">اختر الدور</option>
                                <option value="user">مستخدم</option>
                                <option value="admin">مدير</option>
                                <option value="superadmin">مدير عام</option>
                            </select>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-user-plus"></i>
                                اضافة المستخدم
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- User Section -->
        <div id="user-section" class="hidden">
            <!-- Desktop Navigation -->
            <div class="user-header d-none d-lg-block">
                <div class="row align-items-center">
                    <div class="col-lg-6">
                        <div class="page-title">
                            <i class="fas fa-shopping-cart text-success"></i>
                            <h2>نظام الطلبات</h2>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="user-nav-actions">
                            <button id="view-profile-btn-user" class="btn btn-outline-info">
                                <i class="fas fa-user"></i>
                                <span class="d-none d-xl-inline">ملفي الشخصي</span>
                            </button>
                            <button id="return-to-admin-btn" class="btn btn-outline-primary hidden">
                                <i class="fas fa-arrow-left"></i>
                                <span class="d-none d-xl-inline">العودة للوحة التحكم</span>
                            </button>
                            <button id="logout-user" class="btn btn-outline-danger">
                                <i class="fas fa-sign-out-alt"></i>
                                <span class="d-none d-xl-inline">تسجيل الخروج</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            
            <!-- Availability Check Section -->
            <div class="enhanced-card mb-4 availability-check-card">
                <div class="enhanced-card-header">
                    <i class="fas fa-calendar-check text-info"></i>
                    <h4>اختر فترة الحجز لعرض المخزون المتاح</h4>
                </div>
                <div class="enhanced-card-body">
                    <div class="availability-form">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="form-group">
                                    <label for="availability-start-time">
                                        <i class="fas fa-play-circle"></i>
                                        بداية الحجز
                                    </label>
                                    <input type="datetime-local" class="form-control" id="availability-start-time" required>
                                </div>
                            </div>
                            <div class="col-md-5">
                                <div class="form-group">
                                    <label for="availability-end-time">
                                        <i class="fas fa-stop-circle"></i>
                                        نهاية الحجز
                                    </label>
                                    <input type="datetime-local" class="form-control" id="availability-end-time" required>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group">
                                    <label class="d-none d-md-block">&nbsp;</label>
                                    <button type="button" class="btn btn-primary btn-block availability-btn" id="check-availability-btn">
                                        <i class="fas fa-search"></i>
                                        <span class="d-none d-lg-inline">فحص التوافر</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-info availability-alert" id="availability-status" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            <small><strong>تنبيه:</strong> يرجى اختيار فترة الحجز لعرض المخزون المتاح خلال هذه الفترة</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Search Section -->
            <div class="enhanced-card mb-4">
                <div class="enhanced-card-body">
                    <div class="search-section">
                        <div class="search-input-group">
                            <div class="search-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <input type="text" class="form-control search-input" id="search-input" placeholder="البحث عن المنتجات بالاسم...">
                            <button id="reset-search-btn" class="btn btn-outline-secondary reset-btn">
                                <i class="fas fa-times">مسح البحث</i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>



            
            <!-- Products Section -->
            <div class="enhanced-card mb-4">
                <div class="enhanced-card-header">
                    <i class="fas fa-boxes text-primary"></i>
                    <h3>المنتجات المتاحة</h3>
                </div>
                <div class="enhanced-card-body">
                    <div class="products-grid" id="user-products">
                        <!-- Dynamic product cards will be loaded here -->
                    </div>
                    
                    <!-- Pagination Controls -->
                    <div class="pagination-section mt-4">
                        <nav aria-label="Product pagination">
                            <ul class="pagination justify-content-center" id="pagination-controls">
                                <!-- Pagination buttons will be generated here -->
                            </ul>
                        </nav>
                        <div class="text-center text-muted">
                            <small id="pagination-info">جاري التحميل...</small>
                        </div>
                    </div>
                </div>
            </div>

                        <!-- Current Cart Section -->
                        <div class="enhanced-card mb-4">
                            <div class="enhanced-card-header">
                                <i class="fas fa-shopping-basket text-success"></i>
                                <h3>طلباتي الحالية</h3>
                                <div class="cart-badge" id="cart-badge" style="display: none;">
                                    <span id="cart-count">0</span>
                                </div>
                            </div>
                            <div class="enhanced-card-body">
                                <div id="current-request-items" class="cart-items-container">
                                    <div class="empty-cart">
                                        <i class="fas fa-shopping-cart"></i>
                                        <p>لم تقم بإضافة أي منتجات للطلب بعد.</p>
                                    </div>
                                </div>
                                
                                <!-- Request Form -->
                                <form id="finalize-request-form" class="request-form mt-4" style="display: none;">
                                    <div class="form-section">
                                        <h5><i class="fas fa-user-edit"></i> بيانات المستلم</h5>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="request-recipient-name">
                                                        <i class="fas fa-user"></i>
                                                        اسم المستلم
                                                    </label>
                                                    <input type="text" class="form-control" id="request-recipient-name" placeholder="اسم المستلم" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="request-recipient-mobile">
                                                        <i class="fas fa-mobile-alt"></i>
                                                        رقم موبايل المستلم
                                                    </label>
                                                    <input type="tel" class="form-control" id="request-recipient-mobile" placeholder="رقم موبايل المستلم" required>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-section">
                                        <h5><i class="fas fa-calendar-alt"></i> تفاصيل الحجز</h5>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label for="request-unit">
                                                        <i class="fas fa-users"></i>
                                                        الوحدة
                                                    </label>
                                                    <select class="form-control" id="request-unit" required>
                                                        <option value="">اختر الوحدة</option>
                                                        <option value="براعم اولاد">براعم اولاد</option>
                                                        <option value="براعم بنات">براعم بنات</option>
                                                        <option value="اشبال">اشبال</option>
                                                        <option value="زهرات">زهرات</option>
                                                        <option value="كشافة">كشافة</option>
                                                        <option value="مرشدات">مرشدات</option>
                                                        <option value="متقدم">متقدم</option>
                                                        <option value="جوالة">جوالة</option>
                                                        <option value="عمادة">عمادة</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label for="request-start-time">
                                                        <i class="fas fa-play-circle"></i>
                                                        بداية الحجز
                                                    </label>
                                                    <input type="datetime-local" class="form-control" id="request-start-time" required>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label for="request-end-time">
                                                        <i class="fas fa-stop-circle"></i>
                                                        نهاية الحجز
                                                    </label>
                                                    <input type="datetime-local" class="form-control" id="request-end-time" required>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="alert alert-info pickup-info">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <strong>تنبيه:</strong> مكان الاستلام و التسليم غرفة العهدة
                                    </div>
                                    
                                    <button type="submit" class="btn btn-success btn-lg btn-block complete-request-btn" id="complete-request-btn" disabled>
                                        <i class="fas fa-check-circle"></i>
                                        إتمام الطلب
                                    </button>
                                </form>
                            </div>
                        </div>
            
            
            <!-- User Reservations Section -->
            <div class="enhanced-card">
                <div class="enhanced-card-header">
                    <i class="fas fa-history text-info"></i>
                    <h3>طلبات الحجز السابقة</h3>
                </div>
                <div class="enhanced-card-body">
                    <div class="table-responsive">
                        <table id="reservations-table" class="table table-hover enhanced-table">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-user"></i> المستخدم</th>
                                    <th><i class="fas fa-boxes"></i> المنتجات</th>
                                    <th><i class="fas fa-sort-numeric-up"></i> الكمية</th>
                                    <th><i class="fas fa-calendar-alt"></i> من</th>
                                    <th><i class="fas fa-calendar-alt"></i> إلى</th>
                                    <th><i class="fas fa-info-circle"></i> الحالة</th>
                                    <th><i class="fas fa-cogs"></i> الاختيارات</th>
                                </tr>
                            </thead>
                            <tbody id="reservations-table-body">
                                <!-- Dynamic content will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Management Modal -->
        <div id="manage-users-modal" class="modal hidden">
            <div class="enhanced-modal-content large-modal">
                <div class="enhanced-modal-header">
                    <h3><i class="fas fa-users-cog text-info"></i> إدارة المستخدمين</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="enhanced-modal-body">
                    <div class="modal-actions mb-3">
                        <button id="refresh-users-btn" class="btn btn-secondary">
                            <i class="fas fa-sync-alt"></i>
                            تحديث القائمة
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover enhanced-table">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-envelope"></i> البريد الإلكتروني</th>
                                    <th><i class="fas fa-user-tag"></i> الدور</th>
                                    <th><i class="fas fa-calendar-plus"></i> تاريخ الإنشاء</th>
                                    <th><i class="fas fa-cogs"></i> الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <tr>
                                    <td colspan="4" class="text-center">
                                        <i class="fas fa-spinner fa-spin"></i>
                                        جاري التحميل...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit User Role Modal -->
        <div id="edit-user-modal" class="modal hidden">
            <div class="enhanced-modal-content">
                <div class="enhanced-modal-header">
                    <h3><i class="fas fa-user-edit text-warning"></i> تعديل دور المستخدم</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="enhanced-modal-body">
                    <form id="edit-user-form">
                        <div class="form-group">
                            <label for="edit-user-email">
                                <i class="fas fa-envelope"></i>
                                البريد الإلكتروني
                            </label>
                            <input type="email" class="form-control" id="edit-user-email" readonly>
                        </div>
                        <div class="form-group">
                            <label for="edit-user-role">
                                <i class="fas fa-user-tag"></i>
                                الدور الجديد
                            </label>
                            <select class="form-control" id="edit-user-role" required>
                                <option value="user">مستخدم</option>
                                <option value="admin">مدير</option>
                                <option value="superadmin">مدير عام</option>
                            </select>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-save"></i>
                                تحديث الدور
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Reservation Details Modal -->
        <div id="reservation-details-modal" class="modal hidden">
            <div class="enhanced-modal-content large-modal">
                <div class="enhanced-modal-header">
                    <h3><i class="fas fa-clipboard-list text-info"></i> تفاصيل الطلب</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="enhanced-modal-body">
                    <div id="reservation-details-content">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Profile Modal -->
        <div id="profile-modal" class="modal hidden">
            <div class="enhanced-modal-content profile-modal">
                <div class="enhanced-modal-header">
                    <h3><i class="fas fa-user-circle text-primary"></i> ملفي الشخصي</h3>
                    <span class="close">&times;</span>
                </div>
                <div class="enhanced-modal-body">
                    <!-- Profile View Section (Default) -->
                    <div id="profile-view-section">
                        <div class="profile-image-section">
                            <div class="profile-image-container">
                                <img id="profile-modal-image" src="" alt="صورة الملف الشخصي" 
                                     class="profile-image"
                                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik03NSA3NUMzNy41IDc1IDM3LjUgMzcuNSA3NSAzNy41Uzc1IDM3LjUgNzUgNzVaIiBmaWxsPSIjOUNBM0FGIi8+CjxwYXRoIGQ9Ik03NSAxMTIuNUM1MC42MjUgMTEyLjUgMzEuMjUgOTMuMTI1IDMxLjI1IDc1UzUwLjYyNSAzNy41IDc1IDM3LjVTMTE4Ljc1IDU2Ljg3NSAxMTguNzUgNzVTOTkuMzc1IDExMi41IDc1IDExMi41WiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4K'">
                                <div class="profile-image-overlay">
                                    <i class="fas fa-camera"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-info-grid">
                            <div class="profile-info-item">
                                <div class="profile-info-icon">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="profile-info-content">
                                    <label>الاسم</label>
                                    <p id="profile-modal-name">-</p>
                                </div>
                            </div>
                            
                            <div class="profile-info-item">
                                <div class="profile-info-icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <div class="profile-info-content">
                                    <label>البريد الإلكتروني</label>
                                    <p id="profile-modal-email">-</p>
                                </div>
                            </div>
                            
                            <div class="profile-info-item">
                                <div class="profile-info-icon">
                                    <i class="fas fa-mobile-alt"></i>
                                </div>
                                <div class="profile-info-content">
                                    <label>رقم الهاتف</label>
                                    <p id="profile-modal-phone">-</p>
                                </div>
                            </div>
                            
                            <div class="profile-info-item">
                                <div class="profile-info-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="profile-info-content">
                                    <label>الوحدة</label>
                                    <p id="profile-modal-unit">-</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-actions">
                            <button id="edit-profile-btn" class="btn btn-primary btn-lg">
                                <i class="fas fa-edit"></i>
                                تعديل الملف الشخصي
                            </button>
                        </div>
                    </div>
                    
                    <!-- Profile Edit Section (Hidden initially) -->
                    <div id="profile-edit-section" style="display: none;">
                        <form id="profile-edit-form">
                            <div class="profile-edit-image-section">
                                <div class="profile-edit-image-container">
                                    <img id="edit-profile-image-preview" src="" alt="معاينة الصورة" 
                                         class="profile-edit-image"
                                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik02MCA2MEM0MCA2MCA0MCA0MCA2MCA0MFM2MCA0MCA2MCA2MFoiIGZpbGw9IiM5Q0EzQUYiLz4KPHBhdGggZD0iTTYwIDkwQzQwLjUgOTAgMjUgNzQuNSAyNSA2MFM0MC41IDMwIDYwIDMwUzk1IDQ1LjUgOTUgNjBTNzkuNSA5MCA2MCA5MFoiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+Cg=='">
                                    <input type="file" id="edit-profile-image-input" accept="image/*" style="display: none;">
                                    <div class="profile-edit-image-overlay">
                                        <i class="fas fa-camera"></i>
                                        <span>إضغط لتغيير الصورة</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-edit-form-grid">
                                <div class="form-group">
                                    <label for="edit-profile-name">
                                        <i class="fas fa-user"></i>
                                        الاسم
                                    </label>
                                    <input type="text" class="form-control" id="edit-profile-name" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="edit-profile-phone">
                                        <i class="fas fa-mobile-alt"></i>
                                        رقم الهاتف
                                    </label>
                                    <input type="tel" class="form-control" id="edit-profile-phone">
                                </div>
                                
                                <div class="form-group">
                                    <label for="edit-profile-unit">
                                        <i class="fas fa-users"></i>
                                        الوحدة
                                    </label>
                                    <select class="form-control" id="edit-profile-unit">
                                        <option value="">اختر الوحدة...</option>
                                        <option value="براعم اولاد">براعم اولاد</option>
                                        <option value="براعم بنات">براعم بنات</option>
                                        <option value="اشبال">اشبال</option>
                                        <option value="زهرات">زهرات</option>
                                        <option value="كشافة">كشافة</option>
                                        <option value="مرشدات">مرشدات</option>
                                        <option value="متقدم">متقدم</option>
                                        <option value="جوالة">جوالة</option>
                                        <option value="عمادة">عمادة</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="profile-edit-actions">
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i>
                                    حفظ التغييرات
                                </button>
                                <button type="button" id="cancel-edit-profile-btn" class="btn btn-secondary">
                                    <i class="fas fa-times"></i>
                                    إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Toast Notification Container -->
        <div class="toast-container" id="toast-container">
            <!-- Dynamic toast notifications will be added here -->
        </div>
    </div>

    <!-- Firebase SDKs (version 8.x) - Load FIRST -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!-- Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <!-- Custom JavaScript - Load AFTER Firebase -->
    <script src="script.js"></script>
    
    <!-- Mobile Navigation Handler -->
    <script>
        // Mobile Navigation Management
        function updateMobileNavigation() {
            const mobileNavActions = document.getElementById('mobile-nav-actions');
            const adminSection = document.getElementById('admin-section');
            const userSection = document.getElementById('user-section');
            const authSection = document.getElementById('auth-section');
            
            if (!mobileNavActions) return;
            
            // Clear existing actions
            mobileNavActions.innerHTML = '';
            
            // Check which section is visible
            if (!adminSection.classList.contains('hidden')) {
                // Admin section is visible
                mobileNavActions.innerHTML = `
                    <button onclick="document.getElementById('view-profile-btn').click()" class="btn btn-outline-light">
                        <i class="fas fa-user"></i>
                    </button>
                    <button onclick="document.getElementById('logout-admin').click()" class="btn btn-outline-light">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                `;
            } else if (!userSection.classList.contains('hidden')) {
                // User section is visible
                const returnBtn = document.getElementById('return-to-admin-btn');
                const showReturnBtn = returnBtn && !returnBtn.classList.contains('hidden');
                
                mobileNavActions.innerHTML = `
                    <button onclick="document.getElementById('view-profile-btn-user').click()" class="btn btn-outline-light">
                        <i class="fas fa-user"></i>
                    </button>
                    ${showReturnBtn ? `
                    <button onclick="document.getElementById('return-to-admin-btn').click()" class="btn btn-outline-light">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    ` : ''}
                    <button onclick="document.getElementById('logout-user').click()" class="btn btn-outline-light">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                `;
            }
        }
        
        // Update cart badge
        function updateCartBadge() {
            const cartBadge = document.getElementById('cart-badge');
            const cartCount = document.getElementById('cart-count');
            
            if (cartBadge && cartCount && typeof currentCart !== 'undefined') {
                const totalItems = currentCart.reduce((sum, item) => sum + item.quantity, 0);
                if (totalItems > 0) {
                    cartCount.textContent = totalItems;
                    cartBadge.style.display = 'flex';
                } else {
                    cartBadge.style.display = 'none';
                }
            }
        }
        
        // Enhanced modal show function
        function showEnhancedModal(modal) {
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }
        
        // Enhanced modal hide function
        function hideEnhancedModal(modal) {
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        }
        
        // Override existing modal functions if they exist
        if (typeof showModal === 'function') {
            const originalShowModal = showModal;
            showModal = function(modal) {
                showEnhancedModal(modal);
            };
        }
        
        if (typeof hideModal === 'function') {
            const originalHideModal = hideModal;
            hideModal = function(modal) {
                hideEnhancedModal(modal);
            };
        }
        
        // Initialize mobile navigation when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Update mobile navigation periodically
            setInterval(updateMobileNavigation, 1000);
            
            // Update cart badge periodically
            setInterval(updateCartBadge, 500);
            
            // Handle modal close buttons
            document.querySelectorAll('.close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        hideEnhancedModal(modal);
                    }
                });
            });
            
            // Handle modal backdrop clicks
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideEnhancedModal(this);
                    }
                });
            });
        });
    </script>
</body>
</html> 