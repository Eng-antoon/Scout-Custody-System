<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام عهدة الكشافة</title>
    
    <!-- Bootstrap CSS 4.5.2 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Main Heading -->
        <div class="row">
            <div class="col-12 text-center">
                <h1 class="mt-4 mb-4">نظام عهدة كشافة</h1>
            </div>
        </div>

        <!-- Authentication Section -->
        <div id="auth-section" class="hidden">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header text-center">
                            <h3>تسجيل الدخول</h3>
                        </div>
                        <div class="card-body">
                            <form id="login-form">
                                <div class="form-group">
                                    <label for="login-email">البريد الالكتروني:</label>
                                    <input type="email" class="form-control" id="login-email" required>
                                </div>
                                <div class="form-group">
                                    <label for="login-password">كلمة السر:</label>
                                    <input type="password" class="form-control" id="login-password" required>
                                </div>
                                <button type="submit" class="btn btn-primary btn-block">تسجيل دخول</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Section -->
        <div id="admin-section" class="hidden">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>وحدة التحكم</h2>
                        <div>
                            <button id="view-profile-btn" class="btn btn-outline-info ml-2">ملفي الشخصي</button>
                            <button id="logout-admin" class="btn btn-outline-danger">تسجيل خروج</button>
                        </div>
                    </div>
                    
                    <!-- Admin Management Buttons -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4>إدارة النظام</h4>
                                </div>
                                <div class="card-body">
                                    <div class="btn-group" role="group">
                                        <button id="create-user-btn" class="btn btn-success ml-2">اضافة مستخدم جديد</button>
                                        <button id="manage-users-btn" class="btn btn-info ml-2">إدارة المستخدمين</button>
                                        <button id="go-to-dashboard-btn" class="btn btn-warning ml-2">لوحة بيانات النظام</button>
                                        <button id="switch-user-mode-btn" class="btn btn-secondary">نظام الطلبات</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Add Product Section -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h3>اضافة منتج</h3>
                        </div>
                        <div class="card-body">
                            <form id="product-form">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="product-name-en">الاسم بالانجليزي:</label>
                                            <input type="text" class="form-control" id="product-name-en" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="product-name-ar">الاسم بالعربي:</label>
                                            <input type="text" class="form-control" id="product-name-ar" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="product-counter">العدد بالعهدة:</label>
                                            <input type="number" class="form-control" id="product-counter" min="0" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="product-image">صورة العهدة:</label>
                                            <input type="file" class="form-control-file" id="product-image" accept="image/*">
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">اضافة العهدة</button>
                            </form>
                        </div>
                    </div>

                    <!-- Products Table Section -->
                    <div class="card">
                        <div class="card-header">
                            <h3>المنتجات</h3>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table id="products-table" class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>الصورة</th>
                                            <th>الاسم بالانجليزي</th>
                                            <th>الاسم بالعربي</th>
                                            <th>العدد</th>
                                            <th>الاختيارات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="products-table-body">
                                        <!-- Dynamic content will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reservations Approval Table Section -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3>قبول و رفض الطلبات</h3>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table id="reservations-approval-table" class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>البريد الالكتروني</th>
                                            <th>المنتجات</th>
                                            <th>الكمية الإجمالية</th>
                                            <th>تاريخ بدء الحجز</th>
                                            <th>تاريخ عودة العهدة</th>
                                            <th>الحالة</th>
                                            <th>الاختيارات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reservations-approval-table-body">
                                        <!-- Dynamic content will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Product Modal -->
        <div id="edit-product-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>تعديل منتج</h3>
                <form id="edit-product-form">
                    <div class="form-group">
                        <label for="edit-product-name-en">الاسم بالانجليزي:</label>
                        <input type="text" class="form-control" id="edit-product-name-en" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-name-ar">الاسم بالعربي:</label>
                        <input type="text" class="form-control" id="edit-product-name-ar" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-counter">العدد بالعهدة:</label>
                        <input type="number" class="form-control" id="edit-product-counter" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-product-image">صورة العهدة (اختياري):</label>
                        <input type="file" class="form-control-file" id="edit-product-image" accept="image/*">
                        <small class="form-text text-muted">اتركه فارغاً للاحتفاظ بالصورة الحالية</small>
                    </div>
                    <button type="submit" class="btn btn-primary">تحديث</button>
                </form>
            </div>
        </div>

        <!-- Create User Modal -->
        <div id="create-user-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>Create New User</h3>
                <form id="create-user-form">
                    <div class="form-group">
                        <label for="new-user-email">البريد الالكتروني:</label>
                        <input type="email" class="form-control" id="new-user-email" required>
                    </div>
                    <div class="form-group">
                        <label for="new-user-password">كلمة السر:</label>
                        <input type="password" class="form-control" id="new-user-password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="new-user-role">الدور:</label>
                        <select class="form-control" id="new-user-role" required>
                            <option value="">اختر الدور</option>
                            <option value="user">مستخدم</option>
                            <option value="admin">مدير</option>
                            <option value="superadmin">مدير عام</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">اضافة المستخدم</button>
                </form>
            </div>
        </div>

        <!-- User Section -->
        <div id="user-section" class="hidden">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>نظام الطلبات</h2>
                        <div>
                            <button id="view-profile-btn-user" class="btn btn-outline-info ml-2">ملفي الشخصي</button>
                            <button id="return-to-admin-btn" class="btn btn-outline-primary ml-2 hidden">العودة للوحة التحكم</button>
                            <button id="logout-user" class="btn btn-outline-danger">تسجيل الخروج</button>
                        </div>
                    </div>
                    
                    <!-- Search Bar -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <input type="text" class="form-control" id="search-input" placeholder="البحث عن المنتجات بالاسم...">
                                </div>
                                <div class="col-md-4">
                                    <button id="reset-search-btn" class="btn btn-outline-secondary btn-block">مسح البحث</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Date Selection for Availability Check -->
                    <div class="card mb-4 availability-check-card">
                        <div class="card-header">
                            <h4>اختر فترة الحجز لعرض المخزون المتاح</h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="form-group">
                                        <label for="availability-start-time">بداية الحجز:</label>
                                        <input type="datetime-local" class="form-control" id="availability-start-time" required>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="form-group">
                                        <label for="availability-end-time">نهاية الحجز:</label>
                                        <input type="datetime-local" class="form-control" id="availability-end-time" required>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <label>&nbsp;</label>
                                        <button type="button" class="btn btn-primary btn-block" id="check-availability-btn">
                                            فحص التوافر
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="alert alert-info" id="availability-status" style="display: none;">
                                <small><strong>تنبيه:</strong> يرجى اختيار فترة الحجز لعرض المخزون المتاح خلال هذه الفترة</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Current Request/Cart Section -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h3>طلباتي الحالية</h3>
                        </div>
                        <div class="card-body">
                            <!-- Cart Items Display -->
                            <div id="current-request-items">
                                <p class="text-muted text-center">لم تقم بإضافة أي منتجات للطلب بعد.</p>
                            </div>
                            
                            <!-- Shared Reservation Details Form -->
                            <form id="finalize-request-form" class="mt-4" style="display: none;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="request-recipient-name">اسم المستلم:</label>
                                            <input type="text" class="form-control" id="request-recipient-name" placeholder="اسم المستلم" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="request-recipient-mobile">رقم موبايل المستلم:</label>
                                            <input type="tel" class="form-control" id="request-recipient-mobile" placeholder="رقم موبايل المستلم" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="request-unit">الوحدة:</label>
                                            <select class="form-control" id="request-unit" required>
                                                <option value="">اختر الوحدة</option>
                                                <option value="براعم اولاد">براعم اولاد</option>
                                                <option value="براعم بنات">براعم بنات</option>
                                                <option value="اشبال">اشبال</option>
                                                <option value="زهرات">زهرات</option>
                                                <option value="كشافة">كشافة</option>
                                                <option value="مرشدات">مرشدات</option>
                                                <option value="متقدم">متقدم</option>
                                                <option value="جوالة">جوالة</option>
                                                <option value="عمادة">عمادة</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="request-start-time">بداية الحجز:</label>
                                            <input type="datetime-local" class="form-control" id="request-start-time" required>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="request-end-time">نهاية الحجز:</label>
                                            <input type="datetime-local" class="form-control" id="request-end-time" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="alert alert-info">
                                    <small><strong>تنبيه:</strong> مكان الاستلام و التسليم غرفة العهدة</small>
                                </div>
                                <button type="submit" class="btn btn-success btn-lg btn-block" id="complete-request-btn" disabled>
                                    إتمام الطلب
                                </button>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Products Section -->
                    <div class="card">
                        <div class="card-header">
                            <h3>المنتجات المتاحة</h3>
                        </div>
                        <div class="card-body">
                            <div class="row" id="user-products">
                                <!-- Dynamic product cards will be loaded here -->
                            </div>
                            
                            <!-- Pagination Controls -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <nav aria-label="Product pagination">
                                        <ul class="pagination justify-content-center" id="pagination-controls">
                                            <!-- Pagination buttons will be generated here -->
                                        </ul>
                                    </nav>
                                    <div class="text-center text-muted">
                                        <small id="pagination-info">جاري التحميل...</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Reservations Table Section -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h3>طلبات الحجز السابقة</h3>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table id="reservations-table" class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>البريد الإلكتروني</th>
                                            <th>المنتجات</th>
                                            <th>الكمية</th>
                                            <th>حجز من</th>
                                            <th>حجز الي</th>
                                            <th>الحالة</th>
                                            <th>الاختيارات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reservations-table-body">
                                        <!-- Dynamic content will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Management Modal -->
        <div id="manage-users-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 900px;">
                <span class="close">&times;</span>
                <h3>إدارة المستخدمين</h3>
                <div class="mb-3">
                    <button id="refresh-users-btn" class="btn btn-secondary">تحديث القائمة</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>البريد الإلكتروني</th>
                                <th>الدور</th>
                                <th>تاريخ الإنشاء</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <tr>
                                <td colspan="4" class="text-center">جاري التحميل...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Edit User Role Modal -->
        <div id="edit-user-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>تعديل دور المستخدم</h3>
                <form id="edit-user-form">
                    <div class="form-group">
                        <label for="edit-user-email">البريد الإلكتروني:</label>
                        <input type="email" class="form-control" id="edit-user-email" readonly>
                    </div>
                    <div class="form-group">
                        <label for="edit-user-role">الدور الجديد:</label>
                        <select class="form-control" id="edit-user-role" required>
                            <option value="user">مستخدم</option>
                            <option value="admin">مدير</option>
                            <option value="superadmin">مدير عام</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">تحديث الدور</button>
                </form>
            </div>
        </div>

        <!-- Reservation Details Modal -->
        <div id="reservation-details-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 800px;">
                <span class="close">&times;</span>
                <h3>تفاصيل الطلب</h3>
                <div id="reservation-details-content">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Profile Modal -->
        <div id="profile-modal" class="modal hidden">
            <div class="modal-content" style="max-width: 600px;">
                <span class="close">&times;</span>
                <h3>ملفي الشخصي</h3>
                
                <!-- Profile View Section (Default) -->
                <div id="profile-view-section">
                    <div class="text-center mb-4">
                        <img id="profile-modal-image" src="" alt="صورة الملف الشخصي" 
                             style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid #ddd;"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik03NSA3NUMzNy41IDc1IDM3LjUgMzcuNSA3NSAzNy41Uzc1IDM3LjUgNzUgNzVaIiBmaWxsPSIjOUNBM0FGIi8+CjxwYXRoIGQ9Ik03NSAxMTIuNUM1MC42MjUgMTEyLjUgMzEuMjUgOTMuMTI1IDMxLjI1IDc1UzUwLjYyNSAzNy41IDc1IDM3LjVTMTE4Ljc1IDU2Ljg3NSAxMTguNzUgNzVTOTkuMzc1IDExMi41IDc1IDExMi41WiIgZmlsbD0iIzlDQTNBRiIvPgo8L3N2Zz4K'">
                    </div>
                    
                    <div class="profile-info">
                        <div class="form-group">
                            <label><strong>الاسم:</strong></label>
                            <p id="profile-modal-name" class="form-control-plaintext">-</p>
                        </div>
                        
                        <div class="form-group">
                            <label><strong>البريد الإلكتروني:</strong></label>
                            <p id="profile-modal-email" class="form-control-plaintext">-</p>
                        </div>
                        
                        <div class="form-group">
                            <label><strong>رقم الهاتف:</strong></label>
                            <p id="profile-modal-phone" class="form-control-plaintext">-</p>
                        </div>
                        
                        <div class="form-group">
                            <label><strong>الوحدة:</strong></label>
                            <p id="profile-modal-unit" class="form-control-plaintext">-</p>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button id="edit-profile-btn" class="btn btn-primary">تعديل الملف الشخصي</button>
                    </div>
                </div>
                
                <!-- Profile Edit Section (Hidden initially) -->
                <div id="profile-edit-section" style="display: none;">
                    <form id="profile-edit-form">
                        <div class="text-center mb-4">
                            <img id="edit-profile-image-preview" src="" alt="معاينة الصورة" 
                                 style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #ddd; cursor: pointer;"
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik02MCA2MEM0MCA2MCA0MCA0MCA2MCA0MFM2MCA0MCA2MCA2MFoiIGZpbGw9IiM5Q0EzQUYiLz4KPHBhdGggZD0iTTYwIDkwQzQwLjUgOTAgMjUgNzQuNSAyNSA2MFM0MC41IDMwIDYwIDMwUzk1IDQ1LjUgOTUgNjBTNzkuNSA5MCA2MCA5MFoiIGZpbGw9IiM5Q0EzQUYiLz4KPC9zdmc+Cg=='">
                            <input type="file" id="edit-profile-image-input" accept="image/*" style="display: none;">
                            <div class="mt-2">
                                <small class="text-muted">إضغط على الصورة لتغييرها</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-profile-name">الاسم:</label>
                            <input type="text" class="form-control" id="edit-profile-name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-profile-phone">رقم الهاتف:</label>
                            <input type="tel" class="form-control" id="edit-profile-phone">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-profile-unit">الوحدة:</label>
                            <select class="form-control" id="edit-profile-unit">
                                <option value="">اختر الوحدة...</option>
                                <option value="براعم اولاد">براعم اولاد</option>
                                <option value="براعم بنات">براعم بنات</option>
                                <option value="اشبال">اشبال</option>
                                <option value="زهرات">زهرات</option>
                                <option value="كشافة">كشافة</option>
                                <option value="مرشدات">مرشدات</option>
                                <option value="متقدم">متقدم</option>
                                <option value="جوالة">جوالة</option>
                                <option value="عمادة">عمادة</option>
                            </select>
                        </div>
                        
                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-success ml-2">حفظ التغييرات</button>
                            <button type="button" id="cancel-edit-profile-btn" class="btn btn-secondary">إلغاء</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Toast Notification Container -->
        <div aria-live="polite" aria-atomic="true" style="position: relative; min-height: 200px;">
            <div id="toast-container" style="position: absolute; top: 0; right: 0;"></div>
        </div>
    </div>

    <!-- Firebase SDKs (version 8.x) - Load FIRST -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!-- Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <!-- Custom JavaScript - Load AFTER Firebase -->
    <script src="script.js"></script>
</body>
</html> 